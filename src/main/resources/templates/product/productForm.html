<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout1}">

<!-- ì‚¬ìš©ì ìŠ¤í¬ë¦½íŠ¸ ì¶”ê°€ -->
<th:block layout:fragment="script">
  <script th:inline="javascript">
    $(document).ready(function(){
      var errorMessage = [[${errorMessage}]];
      if(errorMessage != null){
        alert(errorMessage);
      }

      bindDomEvent();
    });

    function bindDomEvent(){
      $(".custom-file-input").on("change", function() {
        var fileName = $(this).val().split("\\").pop();  //ì´ë¯¸ì§€ íŒŒì¼ëª…
        var fileExt = fileName.substring(fileName.lastIndexOf(".")+1); // í™•ì¥ì ì¶”ì¶œ
        fileExt = fileExt.toLowerCase(); //ì†Œë¬¸ì ë³€í™˜

        if(fileExt != "jpg" && fileExt != "jpeg" && fileExt != "gif" && fileExt != "png" && fileExt != "bmp"){
          alert("ì´ë¯¸ì§€ íŒŒì¼ë§Œ ë“±ë¡ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
          return;
        }

        $(this).siblings(".custom-file-label").html(fileName);
      });
    }
  </script>
</th:block>

<!-- ì‚¬ìš©ì CSS ì¶”ê°€ -->
<th:block layout:fragment="css">
  <style>
    body {
      background-color: #f5f5f5;
    }

    .profile-section {
      display: flex;
      align-items: center;
      padding: 10px 20px;
      background-color: white;
      margin-bottom: 15px;
      border-radius: 4px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    .profile-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: #ee8a3c;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 15px;
    }

    .profile-text {
      font-weight: bold;
    }

    .content-container {
      max-width: 900px;
      margin: 0 auto;
      padding: 0 15px;
    }

    .form-section {
      background-color: white;
      border: 1px solid #ddd;
      border-radius: 4px;
      margin-bottom: 20px;
    }

    .section-header {
      padding: 10px 15px;
      border-bottom: 1px solid #eee;
      background-color: #f9f9f9;
      font-weight: bold;
    }

    .section-content {
      padding: 15px;
    }

    .small-text {
      font-size: 12px;
      color: #666;
      margin-top: 5px;
    }

    .input-field {
      width: 100%;
      padding: 8px 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      margin-bottom: 10px;
    }

    .search-btn {
      background-color: #ee8a3c;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 8px 15px;
      cursor: pointer;
    }

    .price-quantity-section {
      margin-bottom: 15px;
    }

    .price-quantity-row {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }

    .price-quantity-label {
      width: 80px;
      font-weight: bold;
    }

    .price-quantity-input {
      width: 150px;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      margin-right: 10px;
    }

    .price-quantity-unit {
      margin-right: 20px;
    }

    .btn-group {
      text-align: right;
      margin-top: 15px;
    }

    .btn {
      padding: 8px 20px;
      border-radius: 4px;
      font-weight: bold;
      margin-left: 5px;
      cursor: pointer;
    }

    .btn-cancel {
      background-color: #ddd;
      border: none;
      color: #333;
    }

    .btn-save {
      background-color: #ee8a3c;
      border: none;
      color: white;
    }

    .fieldError {
      color: #bd2130;
      font-size: 0.9em;
      margin-top: 5px;
      margin-bottom: 10px;
    }

    .img-div {
      margin-bottom: 10px;
    }

    .custom-file {
      position: relative;
      display: inline-block;
      width: 100%;
      height: calc(1.5em + 0.75rem + 2px);
      margin-bottom: 15px;
    }

    .custom-file-input {
      position: relative;
      z-index: 2;
      width: 100%;
      height: calc(1.5em + 0.75rem + 2px);
      margin: 0;
      opacity: 0;
    }

    .custom-file-label {
      position: absolute;
      top: 0;
      right: 0;
      left: 0;
      z-index: 1;
      height: calc(1.5em + 0.75rem + 2px);
      padding: 0.375rem 0.75rem;
      font-weight: 400;
      line-height: 1.5;
      color: #495057;
      background-color: #fff;
      border: 1px solid #ced4da;
      border-radius: 0.25rem;
    }

    .img-upload-title {
      font-weight: bold;
      margin-bottom: 10px;
      margin-top: 15px;
    }
  </style>
</th:block>

<div layout:fragment="content">
  <!-- í”„ë¡œí•„ ì„¹ì…˜ -->
  <div class="profile-section">
    <div class="profile-icon">
      <span style="color: white;">ğŸ§‘</span>
    </div>
    <span class="profile-text">BBMORE</span>
  </div>

  <div class="content-container">
    <form role="form" method="post" enctype="multipart/form-data" th:object="${productFormDto}">
      <input type="hidden" th:field="*{productCode}">

      <!-- ì¹´í…Œê³ ë¦¬ ì„¹ì…˜ -->
      <div class="form-section">
        <div class="section-header">ì¹´í…Œê³ ë¦¬</div>
        <div class="section-content">
          <div class="form-group">
            <select th:field="*{productSellStatus}" class="input-field">
              <option value="SELL">íŒë§¤ì¤‘</option>
              <option value="SOLD_OUT">í’ˆì ˆ</option>
            </select>
          </div>
        </div>
      </div>

      <!-- ìƒí’ˆëª… ì„¹ì…˜ -->
      <div class="form-section">
        <div class="section-header">ìƒí’ˆëª…</div>
        <div class="section-content">
          <input type="text" th:field="*{productName}" class="input-field" placeholder="ìƒí’ˆëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”">
          <p class="small-text">ìƒí’ˆëª…ì„ 30ìë‚´ì™¸ ê¸¸ê²Œ ì‘ì„± í•˜ì…”ì•¼ë§Œ ê²€ìƒ‰ì‹œ ë…¸ì¶œì— ë„ì›€ì´ ë ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
          <p th:if="${#fields.hasErrors('productName')}" th:errors="*{productName}" class="fieldError">Incorrect data</p>
        </div>
      </div>

      <!-- íŒë§¤ê°€ ì„¹ì…˜ -->
      <div class="form-section">
        <div class="section-header">íŒë§¤ê°€</div>
        <div class="section-content">
          <div class="price-quantity-section">
            <div class="price-quantity-row">
              <div class="price-quantity-label">íŒë§¤ê°€</div>
              <input type="number" th:field="*{productPrice}" class="price-quantity-input" placeholder="ê°€ê²©">
              <span class="price-quantity-unit">ì›</span>
            </div>
            <p th:if="${#fields.hasErrors('productPrice')}" th:errors="*{productPrice}" class="fieldError">Incorrect data</p>

            <div class="price-quantity-row">
              <div class="price-quantity-label">ì¬ê³ </div>
              <input type="number" th:field="*{productQuantity}" class="price-quantity-input" placeholder="ìˆ˜ëŸ‰">
              <span class="price-quantity-unit">ê°œ</span>
            </div>
            <p th:if="${#fields.hasErrors('productQuantity')}" th:errors="*{productQuantity}" class="fieldError">Incorrect data</p>
          </div>
        </div>
      </div>

      <!-- ìƒí’ˆ ìƒì„¸ ë‚´ìš© ì„¹ì…˜ -->
      <div class="form-section">
        <div class="section-header">ìƒí’ˆ ìƒì„¸ ë‚´ìš©</div>
        <div class="section-content">
          <textarea class="input-field" th:field="*{productDetail}" rows="5" placeholder="ìƒí’ˆ ìƒì„¸ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”"></textarea>
          <p th:if="${#fields.hasErrors('productDetail')}" th:errors="*{productDetail}" class="fieldError">Incorrect data</p>
        </div>
      </div>

      <!-- ìƒí’ˆ ì´ë¯¸ì§€ ì„¹ì…˜ -->
      <div class="form-section">
        <div class="section-header">ìƒí’ˆ ì´ë¯¸ì§€</div>
        <div class="section-content">

          <!-- ì›ë˜ ì½”ë“œ ê·¸ëŒ€ë¡œ ì‚¬ìš© -->
          <div th:if="${#lists.isEmpty(productFormDto.productImgDtoList)}">
            <div class="form-group" th:each="num: ${#numbers.sequence(1,5)}">
              <div class="custom-file img-div">
                <input type="file" class="custom-file-input" name="productImgFile">
                <label class="custom-file-label" th:text="ìƒí’ˆì´ë¯¸ì§€ + ${num}"></label>
              </div>
            </div>
          </div>

          <div th:if="${not #lists.isEmpty(productFormDto.productImgDtoList)}">
            <div class="form-group" th:each="productImgDto, status: ${productFormDto.productImgDtoList}">
              <div class="custom-file img-div">
                <input type="file" class="custom-file-input" name="productImgFile">
                <input type="hidden" name="productImgCodeList" th:value="${productImgDto.productImgCode}">
                <label class="custom-file-label" th:text="${not #strings.isEmpty(productImgDto.productOriImgName)} ? ${productImgDto.productOriImgName} : 'ìƒí’ˆì´ë¯¸ì§€' + ${status.index+1}"></label>
              </div>
            </div>
          </div>

        </div>
      </div>

      <div class="btn-group">
        <button type="button" class="btn btn-cancel">ì·¨ì†Œ</button>
        <button th:if="${#strings.isEmpty(productFormDto.productCode)}"
                th:formaction="@{/admin/product/new}"
                type="submit"
                class="btn btn-save">ì €ì¥</button>
        <button th:unless="${#strings.isEmpty(productFormDto.productCode)}"
                th:formaction="@{'/admin/product/' + ${productFormDto.productCode}}"
                type="submit"
                class="btn btn-save">ìˆ˜ì •</button>
      </div>
      <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
    </form>
  </div>
</div>
</html>