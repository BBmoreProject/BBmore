<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout1}">

<!-- 사용자 스크립트 추가 -->
<th:block layout:fragment="script">
  <script th:inline="javascript">
    $(document).ready(function(){
      var errorMessage = [[${errorMessage}]];
      if(errorMessage != null){
        alert(errorMessage);
      }

      bindDomEvent();
    });

    function bindDomEvent(){
      $(".custom-file-input").on("change", function() {
        var fileName = $(this).val().split("\\").pop();  //이미지 파일명
        var fileExt = fileName.substring(fileName.lastIndexOf(".")+1); // 확장자 추출
        fileExt = fileExt.toLowerCase(); //소문자 변환

        if(fileExt != "jpg" && fileExt != "jpeg" && fileExt != "gif" && fileExt != "png" && fileExt != "bmp"){
          alert("이미지 파일만 등록이 가능합니다.");
          return;
        }

        $(this).siblings(".custom-file-label").html(fileName);
      });
    }
  </script>
</th:block>

<!-- 사용자 CSS 추가 -->
<th:block layout:fragment="css">
  <style>
    body {
      background-color: #f5f5f5;
    }

    .profile-section {
      display: flex;
      align-items: center;
      padding: 10px 20px;
      background-color: white;
      margin-bottom: 15px;
      border-radius: 4px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    .profile-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: #ee8a3c;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 15px;
    }

    .profile-text {
      font-weight: bold;
    }

    .content-container {
      max-width: 900px;
      margin: 0 auto;
      padding: 0 15px;
    }

    .form-section {
      background-color: white;
      border: 1px solid #ddd;
      border-radius: 4px;
      margin-bottom: 20px;
    }

    .section-header {
      padding: 10px 15px;
      border-bottom: 1px solid #eee;
      background-color: #f9f9f9;
      font-weight: bold;
    }

    .section-content {
      padding: 15px;
    }

    .small-text {
      font-size: 12px;
      color: #666;
      margin-top: 5px;
    }

    .input-field {
      width: 100%;
      padding: 8px 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      margin-bottom: 10px;
    }

    .search-btn {
      background-color: #ee8a3c;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 8px 15px;
      cursor: pointer;
    }

    .price-quantity-section {
      margin-bottom: 15px;
    }

    .price-quantity-row {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }

    .price-quantity-label {
      width: 80px;
      font-weight: bold;
    }

    .price-quantity-input {
      width: 150px;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      margin-right: 10px;
    }

    .price-quantity-unit {
      margin-right: 20px;
    }

    .btn-group {
      text-align: right;
      margin-top: 15px;
    }

    .btn {
      padding: 8px 20px;
      border-radius: 4px;
      font-weight: bold;
      margin-left: 5px;
      cursor: pointer;
    }

    .btn-cancel {
      background-color: #ddd;
      border: none;
      color: #333;
    }

    .btn-save {
      background-color: #ee8a3c;
      border: none;
      color: white;
    }

    .fieldError {
      color: #bd2130;
      font-size: 0.9em;
      margin-top: 5px;
      margin-bottom: 10px;
    }

    .img-div {
      margin-bottom: 10px;
    }

    .custom-file {
      position: relative;
      display: inline-block;
      width: 100%;
      height: calc(1.5em + 0.75rem + 2px);
      margin-bottom: 15px;
    }

    .custom-file-input {
      position: relative;
      z-index: 2;
      width: 100%;
      height: calc(1.5em + 0.75rem + 2px);
      margin: 0;
      opacity: 0;
    }

    .custom-file-label {
      position: absolute;
      top: 0;
      right: 0;
      left: 0;
      z-index: 1;
      height: calc(1.5em + 0.75rem + 2px);
      padding: 0.375rem 0.75rem;
      font-weight: 400;
      line-height: 1.5;
      color: #495057;
      background-color: #fff;
      border: 1px solid #ced4da;
      border-radius: 0.25rem;
    }

    .img-upload-title {
      font-weight: bold;
      margin-bottom: 10px;
      margin-top: 15px;
    }
  </style>
</th:block>

<div layout:fragment="content">
  <!-- 프로필 섹션 -->
  <div class="profile-section">
    <div class="profile-icon">
      <span style="color: white;">🧑</span>
    </div>
    <span class="profile-text">BBMORE</span>
  </div>

  <div class="content-container">
    <form role="form" method="post" enctype="multipart/form-data" th:object="${productFormDto}">
      <input type="hidden" th:field="*{productCode}">

      <!-- 카테고리 섹션 -->
      <div class="form-section">
        <div class="section-header">카테고리</div>
        <div class="section-content">
          <div class="form-group">
            <select th:field="*{productSellStatus}" class="input-field">
              <option value="SELL">판매중</option>
              <option value="SOLD_OUT">품절</option>
            </select>
          </div>
        </div>
      </div>

      <!-- 상품명 섹션 -->
      <div class="form-section">
        <div class="section-header">상품명</div>
        <div class="section-content">
          <input type="text" th:field="*{productName}" class="input-field" placeholder="상품명을 입력해주세요">
          <p class="small-text">상품명을 30자내외 길게 작성 하셔야만 검색시 노출에 도움이 될수 있습니다.</p>
          <p th:if="${#fields.hasErrors('productName')}" th:errors="*{productName}" class="fieldError">Incorrect data</p>
        </div>
      </div>

      <!-- 판매가 섹션 -->
      <div class="form-section">
        <div class="section-header">판매가</div>
        <div class="section-content">
          <div class="price-quantity-section">
            <div class="price-quantity-row">
              <div class="price-quantity-label">판매가</div>
              <input type="number" th:field="*{productPrice}" class="price-quantity-input" placeholder="가격">
              <span class="price-quantity-unit">원</span>
            </div>
            <p th:if="${#fields.hasErrors('productPrice')}" th:errors="*{productPrice}" class="fieldError">Incorrect data</p>

            <div class="price-quantity-row">
              <div class="price-quantity-label">재고</div>
              <input type="number" th:field="*{productQuantity}" class="price-quantity-input" placeholder="수량">
              <span class="price-quantity-unit">개</span>
            </div>
            <p th:if="${#fields.hasErrors('productQuantity')}" th:errors="*{productQuantity}" class="fieldError">Incorrect data</p>
          </div>
        </div>
      </div>

      <!-- 상품 상세 내용 섹션 -->
      <div class="form-section">
        <div class="section-header">상품 상세 내용</div>
        <div class="section-content">
          <textarea class="input-field" th:field="*{productDetail}" rows="5" placeholder="상품 상세 내용을 입력해주세요"></textarea>
          <p th:if="${#fields.hasErrors('productDetail')}" th:errors="*{productDetail}" class="fieldError">Incorrect data</p>
        </div>
      </div>

      <!-- 상품 이미지 섹션 -->
      <div class="form-section">
        <div class="section-header">상품 이미지</div>
        <div class="section-content">

          <!-- 원래 코드 그대로 사용 -->
          <div th:if="${#lists.isEmpty(productFormDto.productImgDtoList)}">
            <div class="form-group" th:each="num: ${#numbers.sequence(1,5)}">
              <div class="custom-file img-div">
                <input type="file" class="custom-file-input" name="productImgFile">
                <label class="custom-file-label" th:text="상품이미지 + ${num}"></label>
              </div>
            </div>
          </div>

          <div th:if="${not #lists.isEmpty(productFormDto.productImgDtoList)}">
            <div class="form-group" th:each="productImgDto, status: ${productFormDto.productImgDtoList}">
              <div class="custom-file img-div">
                <input type="file" class="custom-file-input" name="productImgFile">
                <input type="hidden" name="productImgCodeList" th:value="${productImgDto.productImgCode}">
                <label class="custom-file-label" th:text="${not #strings.isEmpty(productImgDto.productOriImgName)} ? ${productImgDto.productOriImgName} : '상품이미지' + ${status.index+1}"></label>
              </div>
            </div>
          </div>

        </div>
      </div>

      <div class="btn-group">
        <button type="button" class="btn btn-cancel">취소</button>
        <button th:if="${#strings.isEmpty(productFormDto.productCode)}"
                th:formaction="@{/admin/product/new}"
                type="submit"
                class="btn btn-save">저장</button>
        <button th:unless="${#strings.isEmpty(productFormDto.productCode)}"
                th:formaction="@{'/admin/product/' + ${productFormDto.productCode}}"
                type="submit"
                class="btn btn-save">수정</button>
      </div>
      <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
    </form>
  </div>
</div>
</html>